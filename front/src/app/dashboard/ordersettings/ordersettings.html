<div class="container py-4">
  <h1 class="text-center mb-4" style="color: var(--primary)">ğŸ“¦ Order Management</h1>

  @if (orders && orders.length > 0) {
  <h2 class="mb-3" style="color: var(--text)">All Orders ({{ orders.length }})</h2>

  <div class="row row-cols-1 row-cols-md-2 g-4">
    @for (order of orders; track order._id) {
    <div class="col">
      <div class="card h-100 shadow-sm">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="card-title mb-0" style="color: var(--text)">Order #{{ order._id }}</h3>
            <span
              class="badge"
              [ngClass]="{
                'bg-success': order.status === 'delivered',
                'bg-warning text-dark': order.status === 'pending' || order.status === 'shipped',
                'bg-danger': order.status === 'rejected' || order.status === 'cancelled'
              }"
            >
              {{ order.status }}
            </span>
          </div>

          <p class="card-text mb-1"><strong>User:</strong> {{ order.user }}</p>
          <p class="card-text mb-1">
            <strong>Total:</strong>
            <span style="color: var(--accent)">{{ order.TotalPrice | currency : 'EGP' }}</span>
          </p>
          <p class="card-text mb-3">
            <strong>Placed:</strong> {{ order.orderedAt || order.createdAt | date : 'short' }}
          </p>

          <!-- Dropdown Menu for Status Change -->
          <div class="mb-3">
            <label for="status-{{ order._id }}" class="form-label">Change Status:</label>
            <select
              id="status-{{ order._id }}"
              [(ngModel)]="order.status"
              (change)="updateOrderStatus(order._id, order.status)"
              class="form-select"
            >
              <option value="pending">Pending</option>
              <option value="shipped">Shipped</option>
              <option value="delivered">Delivered</option>
              <option value="rejected">Rejected</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>

          @if (order.items && order.items.length > 0) {
          <div class="mt-3">
            <h4 class="mb-2" style="color: var(--primary)">Items ({{ order.items.length }})</h4>
            <ul class="list-group list-group-flush">
              @for (it of order.items; track it._id) {
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <span style="color: var(--text)">ğŸ›ï¸ {{ it.product }}</span>
                <span class="badge bg-secondary rounded-pill">Qty: {{ it.quantity }}</span>
              </li>
              }
            </ul>
          </div>
          }
        </div>
      </div>
    </div>
    }
  </div>
  } @else {
  <div class="text-center py-5">
    <p class="lead">ğŸ•Šï¸ No orders found yet.</p>
    <a routerLink="/marketplace" class="btn btn-primary btn-lg mt-3">Browse Products</a>
  </div>
  }
</div>
