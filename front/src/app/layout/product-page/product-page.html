<div class="container py-4">
  <h1 class="text-center mb-4" style="color: var(--primary);">Product Details</h1>

  @if (product) {
    <div class="card mb-5 shadow-sm">
      <div class="row g-0">
        <div class="col-md-5">
          <img [src]="staticURL + product.imgURL" class="img-fluid rounded-start" alt="{{ product.name }}" style="height: 100%; object-fit: cover;">
        </div>
        <div class="col-md-7">
          <div class="card-body p-5 my-5">
            <h2 class="card-title" style="color: var(--text);">{{ product.name }}</h2>
            <p class="card-title" style="color: var(--text);">{{ product.category }}</p>
            <p class="card-text lead text-muted">{{ product.description }}</p>
          @if (product.stock < 5) {
            <p class="card-text lead text-muted">Last {{ product.stock }} items, selling out fast!</p>
        }
            <p class="card-text fs-4 fw-bold" style="color: var(--primary);">
              <strong>Price: </strong> <span style="color: var(--accent);">{{ product.price }} EGP</span>
            </p>
            
            <div class="d-flex align-items-center mb-3">
              <ng-container *ngFor="let star of [1, 2, 3, 4, 5]; let i = index">
                <i class="fa-star" [ngClass]="{'fas': +product.rating >= star, 'far': +product.rating < star}" style="color: gold;"></i>
              </ng-container>
              <span class="ms-2 text-muted">({{ product.rating }})</span>
            </div>

            <button class="btn btn-primary btn-lg me-2" (click)="addToCart(product)">Add to Cart</button>
            @if(!isloggedin){<p *ngIf="showMsg" class="text-success mt-3">{{ message }}</p>
}
            @else {
              <div class="d-flex align-items-center">
                    <button class="btn btn-primary btn-md mt-2 me-2" (click)="addToCart(product)">+</button>
                    <!-- <p class="mb-0 fs-5">{{ cartData.items[0].quantity}}</p> -->
                    <button class="btn btn-primary btn-md mt-2 ms-2" (click)="removeItem(product._id)">-</button>
                  </div>

              
              <p *ngIf="showMsg" class="text-success mt-3">{{ message }}</p>
}
          </div>
        </div>
      </div>
    </div>

    <div class="related-products mt-5">
      <h3 class="mb-2" style="color: var(--primary);">Related Products</h3>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        @for (myProduct of relatedProducts; track myProduct._id) {
          <div class="col">
            <div class="card h-100 shadow-sm">
              <!-- Assuming staticURL is available in this component's TS -->
              <img [src]="staticURL + myProduct.imgURL" class="card-img-top" alt="{{ myProduct.name }}" style="height: 180px; object-fit: cover;">
              <div class="card-body d-flex flex-column">
                <h5 class="card-title" style="color: var(--text);">{{ myProduct.name }}</h5>
                <p class="card-text text-muted flex-grow-1">{{ myProduct.description }}</p>
                <p class="card-text fs-5 fw-bold" style="color: var(--primary);">
                  <strong>Price: </strong> <span style="color: var(--accent);">{{ myProduct.price }} EGP</span>
                </p>
                <button class="btn btn-primary w-100" [routerLink]="'/product/' + myProduct.slug">
              View Product
            </button>
                <!-- Optional: You can reuse a product card component -->
                <!-- <app-product [product]="myProduct"></app-product> -->
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  }
</div>
