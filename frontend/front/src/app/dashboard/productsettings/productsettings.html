<div class="container py-4">
  <h1 class="text-center mb-4" style="color: var(--primary);">üõçÔ∏è Product Manager</h1>

  <ul class="nav nav-tabs mb-4">
    <li class="nav-item">
      <button class="nav-link btn-primary" [class.active]="viewProducts" (click)="toggleProducts()" style="color: var(--text);">
        Create New Product
      </button>
    </li>
    <li class="nav-item">
      <button class="nav-link btn-primary" [class.active]="!viewProducts" (click)="toggleProducts()" style="color: var(--text);">
                View Current Products
      </button>
    </li>
  </ul>

  <!-- Only show when viewProducts = true -->
  @if (viewProducts) {
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      @for (myProduct of products; track myProduct._id) {
        <div class="col">
          <div class="card h-100 shadow-sm">
            <img [src]="staticURL + myProduct.imgURL" class="card-img-top" alt="{{ myProduct.name }}" style="height: 200px; object-fit: cover;" />
            <div class="card-body d-flex flex-column">
              <h5 class="card-title" style="color: var(--text);">{{ myProduct.name }}</h5>
              <p class="card-text text-muted flex-grow-1">{{ myProduct.description }}</p>
              <p class="card-text fs-5 fw-bold" style="color: var(--primary);">
                {{ myProduct.price | currency : 'EGP' : 'symbol' }}
              </p>
              <div class="d-grid">
                <button class="btn">Show Product Details</button>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  } @else {
    <!-- Create New Product Form -->
    <div class="card p-4 shadow-sm">
      <h2 class="card-title text-center mb-4" style="color: var(--primary);">Create New Product</h2>

      <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
        <div class="mb-3">
          <label for="name" class="form-label">Product Name</label>
          <input id="name" type="text" formControlName="name" class="form-control" placeholder="Enter product name" />
          @if (productForm.get('name')?.invalid && productForm.get('name')?.touched) {
            <small class="text-danger">Name is required.</small>
          }
        </div>

        <div class="mb-3">
          <label for="description" class="form-label">Description</label>
          <textarea id="description" formControlName="description" rows="3" class="form-control" placeholder="Enter product description"></textarea>
          @if (productForm.get('description')?.invalid && productForm.get('description')?.touched) {
            <small class="text-danger">Description is required (min 10 characters).</small>
          }
        </div>

        <div class="mb-3">
          <label for="price" class="form-label">Price (EGP)</label>
          <input id="price" type="number" formControlName="price" class="form-control" placeholder="Enter price" />
          @if (productForm.get('price')?.invalid && productForm.get('price')?.touched) {
            <small class="text-danger">Please enter a valid price.</small>
          }
        </div>

        <div class="mb-3">
          <label for="imgURL" class="form-label">Image Upload</label>
          <input id="imgURL" name="imgURL" type="file" (change)="onFileSelected($event)" class="form-control" />
        </div>

        <div class="mb-3">
          <label for="slug" class="form-label">Slug</label>
          <input id="slug" type="text" formControlName="slug" class="form-control" placeholder="e.g. blue-hoodie" />
          @if (productForm.get('slug')?.invalid && productForm.get('slug')?.touched) {
            <small class="text-danger">Slug is required.</small>
          }
        </div>

        <div class="mb-3">
          <label for="stock" class="form-label">Stock</label>
          <input id="stock" type="number" formControlName="stock" class="form-control" placeholder="Enter quantity in stock" />
          @if (productForm.get('stock')?.invalid && productForm.get('stock')?.touched) {
            <small class="text-danger">Stock must be at least 1.</small>
          }
        </div>

        <div class="mb-3">
          <label for="category" class="form-label">Category</label>
          <select id="category" formControlName="category" class="form-select">
            <option value="" disabled>Select category</option>
            @for (cat of categories; track cat) {
              <option [value]="cat">{{ cat }}</option>
            }
          </select>
          @if (productForm.get('category')?.invalid && productForm.get('category')?.touched) {
            <small class="text-danger">Please select a category.</small>
          }
        </div>

        <div class="mb-3">
          <label for="rating" class="form-label">Rating</label>
          <input id="rating" type="number" step="0.1" min="0" max="5" formControlName="rating" class="form-control" placeholder="0 - 5" />
          @if (productForm.get('rating')?.invalid && productForm.get('rating')?.touched) {
            <small class="text-danger">Rating must be between 0 and 5.</small>
          }
        </div>

        <div class="d-grid">
          <button type="submit" class="btn btn-primary btn-lg" [disabled]="productForm.invalid">Create Product</button>
        </div>
      </form>
    </div>
  }
</div>
