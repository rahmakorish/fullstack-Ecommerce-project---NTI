import{a as D}from"./chunk-3OPVOZV2.js";import{a as L}from"./chunk-B7WZRXAQ.js";import{A as O,Aa as T,Da as U,Ia as z,K as p,L as g,La as F,N as P,Na as j,O as S,P as _,Q as i,R as n,S as b,W as x,Y as v,_ as s,aa as o,ba as w,ca as l,ga as M,ka as h,ma as y,o as u,p as f,ra as k,w as I,x as m,ya as E,z as d,za as R}from"./chunk-ME4NYIX5.js";var V=(a,r)=>r._id;function q(a,r){if(a&1){let t=x();i(0,"button",25),v("click",function(){u(t);let c=s(2).$implicit,C=s(2);return f(C.removeItem(c.product._id))}),o(1," Remove Item "),n()}}function B(a,r){if(a&1&&(i(0,"div",15)(1,"div",7)(2,"div",16)(3,"h3",17),o(4),n(),p(5,q,2,0,"button",18),n(),i(6,"div",19)(7,"div",20),b(8,"img",21),n(),i(9,"div",22)(10,"p",23)(11,"strong"),o(12,"Product:"),n(),o(13),n(),i(14,"p",24)(15,"strong"),o(16,"Quantity:"),n(),o(17),n()()()()()),a&2){let t=s(),e=t.$implicit,c=t.$index,C=s(2);m(4),l("Item ",c+1),m(),g(e._id?5:-1),m(3),_("alt",M(e.product.name))("src",C.staticURL+e.imgURL,I),m(5),l(" ",e.product.name),m(4),l(" ",e.quantity)}}function H(a,r){if(a&1&&p(0,B,18,7,"div",15),a&2){let t=r.$implicit;g(t.isremoved==!1?0:-1)}}function N(a,r){if(a&1){let t=x();i(0,"div",2)(1,"div",4),P(2,H,1,1,null,null,V),n(),i(4,"div",5)(5,"div",6)(6,"div",7)(7,"h3",8),o(8,"Cart Summary"),n(),i(9,"p",9)(10,"strong"),o(11,"Placed At:"),n(),o(12),h(13,"date"),n(),i(14,"p",10)(15,"strong"),o(16,"Total Cart Price:"),n(),i(17,"span",11),o(18),h(19,"currency"),n()(),i(20,"div",12)(21,"button",13),v("click",function(){u(t);let c=s();return f(c.placeOrderFromCart())}),o(22," Place Order Now! "),n(),i(23,"a",14),o(24,"Browse More Products"),n()()()()()()}if(a&2){let t=s();m(2),S(t.cartItems),m(10),l(" ",y(13,3,t.myCart.createdAt,"medium")),m(6),w(y(19,6,t.myCart.totalItemsPrice,"EGP")),m(3),_("disabled",!t.myCart||!t.cartItems.length)}}function Y(a,r){a&1&&(i(0,"div",3)(1,"p",26),o(2,"Your cart is empty "),n(),i(3,"a",27),o(4,"Browse Products"),n()())}var $=class a{constructor(r,t,e,c){this._cartService=r;this.cdr=t;this._http=e;this.orderServices=c}myOrder;orderItem;myCart;cartItems;item;staticURL=F.staticURL;product;ngOnInit(){this._cartService.displayCart()?.subscribe({next:r=>{console.log("cart data returned "+r.totalItemsPrice),this.myCart=r,this.cartItems=this.myCart.items,this.cdr.detectChanges()},error:r=>console.log(r.message)})}removeItem(r){console.log(r),confirm("Remove this item from cart?")&&this._cartService.removeItem(r).subscribe({next:t=>{this.myCart=t,console.log("my new cart after item removal: "+this.myCart.items),this._cartService.displayCart()?.subscribe({next:e=>{this.myCart=e,this.cartItems=e.items||[],this.cdr.detectChanges()},error:e=>console.error("Failed to refresh cart after item removal:",e.message)})},error:t=>{console.error("Remove item failed:",t)}})}CartToOrder(r){let t=(r.items||[]).map(e=>({product:e.product?typeof e.product=="string"?e.product:e.product._id||e.product:"",quantity:e.quantity}));return{user:r.user,items:t,totalItemsPrice:r.totalItemsPrice}}placeOrderFromCart(){if(!this.myCart||!confirm("Place order for current cart?"))return;let r=this.CartToOrder(this.myCart);this.orderServices.placeOrder(r).subscribe({next:t=>{console.log("Order placed",t);let e=this._cartService.displayCart();e?e.subscribe({next:c=>{this.myCart=c,this.cartItems=c.items||[],this.cdr.detectChanges()},error:c=>console.error(c.message)}):(this.cartItems=[],this.cdr.detectChanges())},error:t=>{console.log(t.message)}})}static \u0275fac=function(t){return new(t||a)(d(D),d(k),d(U),d(j))};static \u0275cmp=O({type:a,selectors:[["app-cart"]],inputs:{product:"product"},decls:7,vars:1,consts:[[1,"container","py-4"],[1,"text-center","mb-4",2,"color","var(--primary)"],[1,"row","g-4"],[1,"text-center","py-5"],[1,"col-lg-8"],[1,"col-lg-4"],[1,"card","shadow-sm"],[1,"card-body"],[1,"card-title","mb-3",2,"color","var(--primary)"],[1,"card-text"],[1,"card-text","fs-5","fw-bold",2,"color","var(--primary)"],[2,"color","var(--accent)"],[1,"d-grid","gap-2","mt-4"],[1,"btn","btn-success","btn-lg",3,"click","disabled"],["routerLink","/marketplace",1,"btn","btn-outline-secondary","btn-lg"],[1,"card","mb-3","shadow-sm"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"card-title","mb-0",2,"color","var(--text)"],["type","button",1,"btn","btn-danger","btn-sm"],[1,"row","align-items-center"],[1,"col-md-3"],[1,"img-fluid","rounded",2,"height","100px","object-fit","cover",3,"src","alt"],[1,"col-md-9"],[1,"mb-1"],[1,"mb-0"],["type","button",1,"btn","btn-danger","btn-sm",3,"click"],[1,"lead"],["routerLink","/marketplace",1,"btn","btn-primary","btn-lg","mt-3"]],template:function(t,e){t&1&&(i(0,"div",0)(1,"h1",1),o(2," My Cart"),n(),i(3,"section"),p(4,N,25,9,"div",2)(5,Y,5,0,"div",3),n(),b(6,"app-order"),n()),t&2&&(m(4),g(e.myCart&&e.cartItems&&e.cartItems.length>0?4:5))},dependencies:[T,L,z,R,E],styles:[".cart-title[_ngcontent-%COMP%]{text-align:center;font-size:2rem;color:#387fdc;margin:2rem 0 1.5rem;font-weight:700;font-family:Segoe UI,sans-serif}.cart-container[_ngcontent-%COMP%]{max-width:850px;margin:0 auto;padding:1rem 2rem 2rem;background-color:#f2f6fd;border-radius:1rem;box-shadow:0 6px 16px #00000014}.cart-item-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:12px;padding:1rem 1.5rem;margin-bottom:1.2rem;box-shadow:0 2px 8px #0000000f;transition:transform .2s ease,box-shadow .2s ease}.cart-item-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px);box-shadow:0 4px 12px #0000001a}.cart-item-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#040a16;font-size:1.1rem;font-weight:600}.cart-item-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.4rem 0;font-size:.95rem;color:#333}.cart-summary[_ngcontent-%COMP%]{margin-top:2rem;padding:1rem;border-radius:10px;background:#eaf1fc;font-size:1.05rem;color:#040a16;box-shadow:inset 0 1px 3px #0000000d}.cart-summary[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.6rem 0}.checkout-btn[_ngcontent-%COMP%]{width:100%;margin-top:1.5rem;padding:.9rem 0;background-color:#387fdc;color:#fff;border:none;border-radius:10px;font-size:1rem;font-weight:600;cursor:pointer;transition:background-color .3s ease,transform .2s ease}.checkout-btn[_ngcontent-%COMP%]:hover{background-color:#2e6ab7;transform:translateY(-2px)}.empty-cart[_ngcontent-%COMP%]{text-align:center;padding:3rem 1rem;font-family:Segoe UI,sans-serif;color:#555}.empty-cart[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:1rem}.browse-btn[_ngcontent-%COMP%]{display:inline-block;padding:.6rem 1.2rem;background-color:#387fdc;color:#fff;text-decoration:none;border-radius:8px;transition:background-color .3s ease}.browse-btn[_ngcontent-%COMP%]:hover{background-color:#2e6ab7}@media (max-width: 600px){.cart-container[_ngcontent-%COMP%]{padding:1rem}.cart-item-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}.checkout-btn[_ngcontent-%COMP%]{font-size:.95rem}}.product-image[_ngcontent-%COMP%]{width:80%;height:180px;object-fit:contain;display:block;margin:0 auto}"]})};export{$ as Cart};
